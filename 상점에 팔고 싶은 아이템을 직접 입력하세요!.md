---
title: "상점에 팔고 싶은 아이템을 직접 입력하세요!"
date: "2025-04-25"
thumbnail: "https://i.ytimg.com/vi/BvdwgqKg8HM/hqdefault.jpg"
tags: ["중급", "베드락", "스크립트API", "소스코드", "설계자", "롱폼"]
url: "https://youtu.be/BvdwgqKg8HM?si=fCSAdWlnyyDCysag"
duration: "2:46"
series: "스크립트 API 튜토리얼"
episode: 4
difficulty: "중급"
---

# 상점에 팔고 싶은 아이템을 직접 입력하세요!

<div align="center">
<img src="https://i.ytimg.com/vi/BvdwgqKg8HM/hqdefault.jpg" alt="썸네일" width="600"/>
</div>

## 목차
- [소개](#소개)
- [주요 기능](#주요-기능)
- [사용 방법](#사용-방법)
- [코드 설명](#코드-설명)
- [자주 묻는 질문](#자주-묻는-질문)
- [추가 리소스](#추가-리소스)

## 소개
이 영상은 마인크래프트 베드락 에디션에서 스크립트 API를 활용하여 재고 관리가 가능한 상점 시스템을 구현하는 방법을 설명합니다. 사용자는 구매와 판매 기능을 모두 사용할 수 있으며, 관리자는 아이템을 추가하거나 제거할 수 있는 직관적인 UI 기반 상점 시스템을 보여줍니다.

## 주요 기능

### 1. 관리자 기능
- 관리자 전용 상점 관리 인터페이스
- 아이템 추가 및 제거 기능
- 아이템별 가격, 재고량, 최대 구매 수량 설정
- 권한 관리(태그 시스템 활용)

### 2. 사용자 기능
- 아이템 구매 및 판매 인터페이스
- 구매 가능한 최대 수량 제한
- 판매 시 구매가의 70% 가격으로 판매
- 재고 시스템으로 인한 현실적인 경제 시스템

### 3. 데이터 관리
- 동적 속성을 통한 데이터 저장
- 월드 종료 후에도 상점 데이터 유지
- 사용자별 구매 내역 추적 기능

## 사용 방법

### 관리자 모드
1. **관리자 권한 획득**: `어드민` 태그를 가진 플레이어만 관리자 기능 사용 가능
2. **관리자 모드 접근**: 
   - 블레이즈 막대를 마우스 오른쪽 클릭
   - 또는 채팅창에 `관리자창` 입력
3. **아이템 관리**:
   - 아이템 추가: 아이템 ID, 표시 이름, 가격, 초기 재고, 최대 구매 수량 입력
   - 아이템 제거: 목록에서 제거할 아이템 선택

### 사용자 모드
1. **상점 열기**: 
   - 에메랄드를 마우스 오른쪽 클릭
   - 또는 채팅창에 `상점` 입력
2. **아이템 구매**:
   - 구매할 아이템 선택
   - 수량 입력 (최대 구매 가능 수량 내에서)
   - 에메랄드로 결제
3. **아이템 판매**:
   - 판매할 아이템 선택
   - 수량 입력
   - 에메랄드로 보상 (구매가의 70%)

## 코드 설명

### 핵심 설정
```javascript
// 아이템 설정
const shopOpenItemId = "minecraft:emerald"; // 상점을 열기 위한 아이템
const adminOpenItemId = "minecraft:blaze_rod"; // 관리자 메뉴를 열기 위한 아이템

// 메시지 설정
const shopOpenMessage = "상점"; // 상점을 열기 위한 채팅 명령어
const adminOpenMessage = "관리자창"; // 관리자 메뉴를 열기 위한 채팅 명령어

// 권한 설정
const adminTagName = "어드민"; // 관리자 권한을 가진 플레이어 태그

// 기본 설정
const defaultStock = 64; // 기본 재고량
const defaultMaxBuy = 64; // 기본 최대 구매 수량
const sellPriceRate = 0.7; // 판매 시 구매가 대비 비율 (70%)

// 기본 상점 아이템
const defaultShopItems = [
    { id: "minecraft:diamond", name: "다이아몬드", price: 8, stock: 64, maxBuy: 64 },
    { id: "minecraft:iron_ingot", name: "철 주괴", price: 2, stock: 64, maxBuy: 64 },
    { id: "minecraft:gold_ingot", name: "금 주괴", price: 4, stock: 64, maxBuy: 64 }
];
```

### 동적 속성 관리
```javascript
// 상점 데이터를 동적 속성으로 저장
world.setDynamicProperty("shopItems", JSON.stringify(defaultShopItems));

// 데이터 불러오기
function getShopItems() {
    const shopItemsJson = world.getDynamicProperty("shopItems");
    return shopItemsJson ? JSON.parse(shopItemsJson) : defaultShopItems;
}

// 데이터 저장하기
function saveShopItems(items) {
    world.setDynamicProperty("shopItems", JSON.stringify(items));
}
```

### 플레이어 구매 내역 관리
```javascript
// 플레이어별 구매 내역 관리
function getPlayerBuyCount(player, itemId) {
    const countProp = player.getDynamicProperty(`buy_${itemId}`);
    return countProp || 0;
}

function setPlayerBuyCount(player, itemId, count) {
    player.setDynamicProperty(`buy_${itemId}`, count);
}
```

## 자주 묻는 질문

**Q: 관리자 권한은 어떻게 부여하나요?**  
A: `/tag <플레이어명> add 어드민` 명령어를 사용하여 관리자 태그를 부여할 수 있습니다. 이 태그를 가진 플레이어만 관리자 기능을 이용할 수 있습니다.

**Q: 아이템을 추가할 때 ID는 어떻게 입력해야 하나요?**  
A: 마인크래프트 아이템 ID는 `minecraft:` 네임스페이스로 시작하며, 정확한 ID를 입력해야 합니다. 예를 들어 사과는 `minecraft:apple`, 철 검은 `minecraft:iron_sword` 등의 형식입니다.

**Q: 판매 가격은 어떻게 결정되나요?**  
A: 판매 가격은 구매 가격의 70%로 설정되어 있습니다. 이 비율은 코드의 `sellPriceRate` 변수를 수정하여 변경할 수 있습니다.

**Q: 상점 데이터는 서버를 재시작해도 유지되나요?**  
A: 네, 상점 데이터는 월드의 동적 속성(Dynamic Property)으로 저장되기 때문에 서버를 재시작하거나 월드를 다시 불러와도 그대로 유지됩니다.

## 추가 리소스
- [전체 코드 GitHub 저장소](https://github.com/ssakspirit/scriptAPI/blob/main/uiInventoryShopSystem.js)
- [스크립트 API 시작하기](https://youtu.be/zBVdaQ0AXOY)
- [복붙한 코드를 애드온으로 바꾸기](https://youtu.be/lZuJxdKgUMg?si=GCOiludeu4HzUGbl)
- [브릿지 가이드](https://youtu.be/L2s8-w8HXIk?si=aWJONVaLN0kngFtg)
- [마인크래프트 베드락 공식 문서](https://learn.microsoft.com/ko-kr/minecraft/creator/scriptapi/minecraft/server/minecraft-server)
- [스티브코딩 페이스북 페이지](https://www.facebook.com/stvcoding/)

## 이런 분들에게 추천합니다
- 마인크래프트 서버 운영자 및 관리자
- 마인크래프트에 경제 시스템을 도입하고 싶은 분
- 스크립트 API를 활용한 UI 개발에 관심 있는 개발자
- 베드락 에디션에서 상점 시스템을 구현하고 싶은 맵 제작자
- 동적 속성을 활용한 데이터 관리 방법을 배우고 싶은 코더

## 관련 튜토리얼
- [스크립트 API의 첫걸음, 채팅명령어 만들기](https://www.youtube.com/watch?v=zBVdaQ0AXOY)
- [커맨드 2개로 되는 완전 간편한 NPC상점](https://www.youtube.com/watch?v=)
- [스크립트 API로 본격적으로 애드온 제작하기](https://www.youtube.com/watch?v=)
- [언제 어디든 아이템을 살 수 있는 UI 상점](https://www.youtube.com/watch?v=)

## 실습 코드
```javascript
// uiInventoryShopSystem.js

// 아이템 설정
const shopOpenItemId = "minecraft:emerald"; // 상점을 열기 위한 아이템
const adminOpenItemId = "minecraft:blaze_rod"; // 관리자 메뉴를 열기 위한 아이템

// 메시지 설정
const shopOpenMessage = "상점"; // 상점을 열기 위한 채팅 명령어
const adminOpenMessage = "관리자창"; // 관리자 메뉴를 열기 위한 채팅 명령어

// 권한 설정
const adminTagName = "어드민"; // 관리자 권한을 가진 플레이어 태그

// 기본 설정
const defaultStock = 64; // 기본 재고량
const defaultMaxBuy = 64; // 기본 최대 구매 수량
const sellPriceRate = 0.7; // 판매 시 구매가 대비 비율 (70%)

// 기본 상점 아이템
const defaultShopItems = [
    { id: "minecraft:diamond", name: "다이아몬드", price: 8, stock: 64, maxBuy: 64 },
    { id: "minecraft:iron_ingot", name: "철 주괴", price: 2, stock: 64, maxBuy: 64 },
    { id: "minecraft:gold_ingot", name: "금 주괴", price: 4, stock: 64, maxBuy: 64 }
];

// 초기 설정
function initialize() {
    // 동적 속성이 없을 경우 기본 상점 아이템 설정
    if (!world.getDynamicProperty("shopItems")) {
        world.setDynamicProperty("shopItems", JSON.stringify(defaultShopItems));
    }
    
    // 아이템 사용 이벤트 등록
    system.afterEvents.itemUse.subscribe(onItemUse);
    
    // 채팅 이벤트 등록
    system.afterEvents.chatSend.subscribe(onChatSend);
}

// 아이템 사용 이벤트 처리
function onItemUse(event) {
    const player = event.source;
    const item = event.itemStack;
    
    if (item.typeId === shopOpenItemId) {
        openShopMenu(player);
    } else if (item.typeId === adminOpenItemId && isAdmin(player)) {
        openAdminMenu(player);
    }
}

// 채팅 이벤트 처리
function onChatSend(event) {
    const player = event.sender;
    const message = event.message.toLowerCase();
    
    if (message === shopOpenMessage) {
        event.cancel = true;
        openShopMenu(player);
    } else if (message === adminOpenMessage && isAdmin(player)) {
        event.cancel = true;
        openAdminMenu(player);
    }
}

// 관리자 권한 확인
function isAdmin(player) {
    return player.hasTag(adminTagName);
}

// 상점 메뉴 열기
function openShopMenu(player) {
    // 상점 UI 구현
    const form = new ActionFormData()
        .setTitle("상점")
        .addButton("구매", "textures/ui/icon_book_writable")
        .addButton("판매", "textures/ui/MCoin");
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        if (response.selection === 0) {
            openBuyMenu(player);
        } else {
            openSellMenu(player);
        }
    });
}

// 구매 메뉴 열기
function openBuyMenu(player) {
    const shopItems = getShopItems();
    
    const form = new ActionFormData()
        .setTitle("아이템 구매")
        .setBody("구매할 아이템을 선택하세요.");
    
    shopItems.forEach(item => {
        const remainingBuy = item.maxBuy - getPlayerBuyCount(player, item.id);
        form.addButton(`${item.name}\n가격: ${item.price} 에메랄드\n재고: ${item.stock}\n구매 가능: ${remainingBuy}`);
    });
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        const selectedItem = shopItems[response.selection];
        openBuyQuantityMenu(player, selectedItem);
    });
}

// 구매 수량 선택 메뉴
function openBuyQuantityMenu(player, item) {
    const remainingBuy = item.maxBuy - getPlayerBuyCount(player, item.id);
    const maxQuantity = Math.min(item.stock, remainingBuy);
    
    if (maxQuantity <= 0) {
        player.sendMessage("§c더 이상 구매할 수 없습니다.");
        return;
    }
    
    const form = new ModalFormData()
        .setTitle(`${item.name} 구매`)
        .addSlider("수량", 1, maxQuantity, 1, 1)
        .addLabel(`가격: ${item.price} 에메랄드 (개당)`);
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        const quantity = response.formValues[0];
        const totalPrice = quantity * item.price;
        
        // 에메랄드 보유량 확인
        const emeraldCount = countPlayerItems(player, "minecraft:emerald");
        
        if (emeraldCount < totalPrice) {
            player.sendMessage("§c에메랄드가 부족합니다.");
            return;
        }
        
        // 아이템 구매 처리
        if (removePlayerItems(player, "minecraft:emerald", totalPrice)) {
            givePlayerItems(player, item.id, quantity);
            
            // 재고 및 구매 기록 업데이트
            updateItemStock(item.id, item.stock - quantity);
            updatePlayerBuyCount(player, item.id, getPlayerBuyCount(player, item.id) + quantity);
            
            player.sendMessage(`§a${item.name} ${quantity}개를 구매했습니다.`);
        } else {
            player.sendMessage("§c구매에 실패했습니다.");
        }
    });
}

// 판매 메뉴 열기
function openSellMenu(player) {
    const shopItems = getShopItems();
    
    const form = new ActionFormData()
        .setTitle("아이템 판매")
        .setBody("판매할 아이템을 선택하세요.");
    
    shopItems.forEach(item => {
        const sellPrice = Math.floor(item.price * sellPriceRate);
        form.addButton(`${item.name}\n판매가: ${sellPrice} 에메랄드`);
    });
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        const selectedItem = shopItems[response.selection];
        openSellQuantityMenu(player, selectedItem);
    });
}

// 판매 수량 선택 메뉴
function openSellQuantityMenu(player, item) {
    const playerItemCount = countPlayerItems(player, item.id);
    
    if (playerItemCount <= 0) {
        player.sendMessage("§c판매할 아이템이 없습니다.");
        return;
    }
    
    const sellPrice = Math.floor(item.price * sellPriceRate);
    
    const form = new ModalFormData()
        .setTitle(`${item.name} 판매`)
        .addSlider("수량", 1, playerItemCount, 1, 1)
        .addLabel(`판매가: ${sellPrice} 에메랄드 (개당)`);
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        const quantity = response.formValues[0];
        const totalSellPrice = Math.floor(quantity * sellPrice);
        
        // 아이템 판매 처리
        if (removePlayerItems(player, item.id, quantity)) {
            if (totalSellPrice > 0) {
                givePlayerItems(player, "minecraft:emerald", totalSellPrice);
            }
            
            // 재고 업데이트
            updateItemStock(item.id, item.stock + quantity);
            
            player.sendMessage(`§a${item.name} ${quantity}개를 판매했습니다. §e(+${totalSellPrice} 에메랄드)`);
        } else {
            player.sendMessage("§c판매에 실패했습니다.");
        }
    });
}

// 관리자 메뉴 열기
function openAdminMenu(player) {
    const form = new ActionFormData()
        .setTitle("상점 관리")
        .addButton("아이템 관리", "textures/ui/debug_glyph_color")
        .addButton("아이템 추가", "textures/ui/color_plus");
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        if (response.selection === 0) {
            openItemManagementMenu(player);
        } else {
            openAddItemMenu(player);
        }
    });
}

// 아이템 관리 메뉴
function openItemManagementMenu(player) {
    const shopItems = getShopItems();
    
    const form = new ActionFormData()
        .setTitle("아이템 관리")
        .setBody("관리할 아이템을 선택하세요.");
    
    shopItems.forEach(item => {
        form.addButton(`${item.name}\n가격: ${item.price} 에메랄드\n재고: ${item.stock}`);
    });
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        const selectedItem = shopItems[response.selection];
        openItemEditMenu(player, selectedItem);
    });
}

// 아이템 수정 메뉴
function openItemEditMenu(player, item) {
    const form = new ActionFormData()
        .setTitle(`${item.name} 관리`)
        .addButton("가격 수정", "textures/ui/MCoin")
        .addButton("재고 설정", "textures/ui/icon_book_writable")
        .addButton("구매 제한 설정", "textures/ui/lock_color")
        .addButton("아이템 제거", "textures/ui/trash_default");
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        switch (response.selection) {
            case 0:
                openEditPriceMenu(player, item);
                break;
            case 1:
                openEditStockMenu(player, item);
                break;
            case 2:
                openEditMaxBuyMenu(player, item);
                break;
            case 3:
                removeShopItem(player, item.id);
                break;
        }
    });
}

// 아이템 추가 메뉴
function openAddItemMenu(player) {
    const form = new ModalFormData()
        .setTitle("아이템 추가")
        .addTextField("아이템 ID", "minecraft:example", "")
        .addTextField("표시 이름", "아이템 이름", "")
        .addSlider("가격 (에메랄드)", 1, 64, 1, 1)
        .addSlider("초기 재고", 1, 64, 1, defaultStock)
        .addSlider("플레이어 구매 수량 제한", 1, 64, 1, defaultMaxBuy);
    
    form.show(player).then(response => {
        if (response.canceled) return;
        
        const [id, name, price, stock, maxBuy] = response.formValues;
        
        if (!id || !name) {
            player.sendMessage("§c아이템 ID와 이름은 필수입니다.");
            return;
        }
        
        addShopItem(player, {
            id: id,
            name: name,
            price: price,
            stock: stock,
            maxBuy: maxBuy
        });
    });
}

// 상점 아이템 목록 가져오기
function getShopItems() {
    const shopItemsJson = world.getDynamicProperty("shopItems");
    return shopItemsJson ? JSON.parse(shopItemsJson) : defaultShopItems;
}

// 상점 아이템 저장하기
function saveShopItems(items) {
    world.setDynamicProperty("shopItems", JSON.stringify(items));
}

// 상점에 아이템 추가
function addShopItem(player, newItem) {
    const shopItems = getShopItems();
    
    // 이미 존재하는 아이템인지 확인
    if (shopItems.some(item => item.id === newItem.id)) {
        player.sendMessage(`§c이미 등록된 아이템입니다: ${newItem.id}`);
        return;
    }
    
    shopItems.push(newItem);
    saveShopItems(shopItems);
    
    player.sendMessage(`§a아이템이 추가되었습니다: ${newItem.name}`);
}

// 상점에서 아이템 제거
function removeShopItem(player, itemId) {
    const shopItems = getShopItems();
    const newItems = shopItems.filter(item => item.id !== itemId);
    
    saveShopItems(newItems);
    
    player.sendMessage(`§a아이템이 제거되었습니다: ${itemId}`);
}

// 아이템 재고 업데이트
function updateItemStock(itemId, newStock) {
    const shopItems = getShopItems();
    
    for (let i = 0; i < shopItems.length; i++) {
        if (shopItems[i].id === itemId) {
            shopItems[i].stock = Math.max(0, newStock);
            break;
        }
    }
    
    saveShopItems(shopItems);
}

// 플레이어 구매 내역 관리
function getPlayerBuyCount(player, itemId) {
    const countProp = player.getDynamicProperty(`buy_${itemId}`);
    return countProp || 0;
}

function updatePlayerBuyCount(player, itemId, count) {
    player.setDynamicProperty(`buy_${itemId}`, count);
}

// 플레이어 아이템 관리 유틸리티
function countPlayerItems(player, itemId) {
    let count = 0;
    
    const inventory = player.getComponent("inventory").container;
    
    for (let i = 0; i < inventory.size; i++) {
        const item = inventory.getItem(i);
        if (item && item.typeId === itemId) {
            count += item.amount;
        }
    }
    
    return count;
}

function removePlayerItems(player, itemId, amount) {
    let remainingToRemove = amount;
    
    const inventory = player.getComponent("inventory").container;
    
    // 첫 번째 패스: 카운트 확인
    for (let i = 0; i < inventory.size; i++) {
        const item = inventory.getItem(i);
        if (item && item.typeId === itemId) {
            remainingToRemove -= Math.min(remainingToRemove, item.amount);
            if (remainingToRemove <= 0) break;
        }
    }
    
    if (remainingToRemove > 0) return false; // 아이템이 충분하지 않음
    
    // 두 번째 패스: 아이템 제거
    remainingToRemove = amount;
    
    for (let i = 0; i < inventory.size; i++) {
        const item = inventory.getItem(i);
        if (item && item.typeId === itemId) {
            const toRemove = Math.min(remainingToRemove, item.amount);
            
            if (toRemove === item.amount) {
                inventory.setItem(i, undefined); // 슬롯에서 아이템 완전히 제거
            } else {
                item.amount -= toRemove;
                inventory.setItem(i, item);
            }
            
            remainingToRemove -= toRemove;
            if (remainingToRemove <= 0) break;
        }
    }
    
    return true;
}

function givePlayerItems(player, itemId, amount) {
    const item = new ItemStack(itemId, amount);
    player.getComponent("inventory").container.addItem(item);
}

// 초기화
initialize();
```

## 태그
#마인크래프트 #베드락 #스크립트API #상점시스템 #경제시스템 #UI개발 #애드온제작 #게임개발 #스티브코딩